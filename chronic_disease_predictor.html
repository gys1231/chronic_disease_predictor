        <!-- /* ì¼ë°˜ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ (ê³µí†µ) */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
                margin: 0;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
                line-height: 1.2;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .form-section {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .form-section h3 {
                font-size: 1.2rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                max-width: none;
                padding: 15px;
                font-size: 1rem;
            }
            
            .results {
                padding: 20px;
                margin-top: 20px;
            }
            
            .chart-title {
                font-size: 1.1rem;
            }
            
            .chart-subtitle {
                font-size: 0.9rem;
            }
            
            .risk-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .risk-card {
                padding: 20px;
            }
            
            .risk-percentage {
                font-size: 2rem;
            }
            
            .risk-icon {
                font-size: 2.5rem;
            }
            
            .modal-content {
                margin: 20% auto;
                padding: 15px;
                width: 95%;
            }
            
            .recommendations {
                padding: 15px;
            }
            
            .disease-recommendations {
                padding: 12px;
            }
            
            /* BMI ì…ë ¥ í•„ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            #bmi {
                width: 70px;
            }
            
            /* í˜ˆì•• ì…ë ¥ í•„ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .form-group div[style*="display: flex"] {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .form-group div[style*="display: flex"] input {
                min-width: 80px;
            }
        } -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3ëŒ€ ë§Œì„±ì§ˆí™˜ ìœ„í—˜ë„ ì˜ˆì¸¡ ì„œë¹„ìŠ¤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .save-status {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .save-status.show {
            opacity: 1;
        }

        .form-container {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            background: #fafafa;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .required-notice {
            background: #fff3cd;
            color: #856404;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            text-align: center;
            flex: 1;
            max-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-download {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }

        .btn-unknown {
            padding: 8px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-unknown:hover {
            background: #5a6268;
        }

        #bmi {
            width: 80px;
            flex-shrink: 0;
        }

        #bmiInterpretation {
            min-width: 100px;
            text-align: center;
        }

        .results {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
        }

        .results h3 {
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.5rem;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            position: relative;
            height: auto;
            width: 100%;
            min-height: 300px;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* Chart.js ì°¨íŠ¸ë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆ */
        .chart-canvas-container {
            position: relative;
            
            width: 100%;
            margin: 20px 0;
            overflow: hidden;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        .bar-chart {
            margin: 20px 0;
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1rem;
            flex-wrap: wrap;
            min-height: 50px;
            width: 100%;
            box-sizing: border-box;
        }

        .bar-label {
            width: 100px;
            font-weight: 600;
            color: #333;
            flex-shrink: 0;
            min-width: 80px;
        }

        /* Progress container ê°œì„  */
        .bar-container {
            flex: 1;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            margin: 0 15px;
            position: relative;
            overflow: hidden;
            min-width: 100px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Progress bar ê°œì„  */
        .bar-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 1s ease-in-out;
            position: relative;
            min-width: 1px;
            display: block;
            box-sizing: border-box;
        }

        .bar-fill.hypertension {
            background: linear-gradient(90deg, #ff6b6b, #ff5252);
        }

        .bar-fill.diabetes {
            background: linear-gradient(90deg, #4ecdc4, #26a69a);
        }

        .bar-fill.hyperlipidemia {
            background: linear-gradient(90deg, #45b7d1, #2196f3);
        }

        .bar-percentage {
            font-weight: 600;
            color: #333;
            min-width: 50px;
            text-align: right;
            flex-shrink: 0;
        }

        .comparison-note {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-top: 20px;
            font-size: 0.95rem;
            color: #555;
        }

        .risk-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
            overflow: hidden;
        }

        .risk-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
        }

        .risk-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .risk-percentage {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .risk-level {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .risk-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .low-risk {
            background: #d4edda;
            color: #155724;
        }

        .moderate-risk {
            background: #fff3cd;
            color: #856404;
        }

        .high-risk {
            background: #f8d7da;
            color: #721c24;
        }

        .low-risk .risk-percentage {
            color: #28a745;
        }

        .moderate-risk .risk-percentage {
            color: #ffc107;
        }

        .high-risk .risk-percentage {
            color: #dc3545;
        }

        .recommendations {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            box-sizing: border-box;
        }

        .recommendations h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .disease-recommendations {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            overflow: hidden;
            box-sizing: border-box;
        }

        .disease-recommendations h5 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            position: relative;
        }

        .recommendations li:last-child {
            border-bottom: none;
        }

        .detail-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            margin-left: 10px;
            font-size: 0.9rem;
        }

        .detail-link:hover {
            text-decoration: underline;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        /* ì°¨íŠ¸ì™€ ì´ë¯¸ì§€ ë°˜ì‘í˜• ì²˜ë¦¬ */
        canvas, img {
            max-width: 100%;
            height: auto;
        }

        /* ë°” ê·¸ë˜í”„ ìƒ‰ìƒ ê°•ì œ í‘œì‹œ */
        .bar-fill {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .bar-fill.hypertension {
            background: linear-gradient(90deg, #ff6b6b, #ff5252) !important;
        }

        .bar-fill.diabetes {
            background: linear-gradient(90deg, #4ecdc4, #26a69a) !important;
        }

        .bar-fill.hyperlipidemia {
            background: linear-gradient(90deg, #45b7d1, #2196f3) !important;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” ë¯¸ë””ì–´ ì¿¼ë¦¬ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
                margin: 0;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
                line-height: 1.2;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .form-section {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .form-section h3 {
                font-size: 1.2rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                max-width: none;
                padding: 15px;
                font-size: 1rem;
            }
            
            .results {
                padding: 20px;
                margin-top: 20px;
            }
            
            .chart-container {
                padding: 15px;
               
            }
            
            .chart-canvas-container {
                height: auto;
                
            }
            
            .chart-title {
                font-size: 1.1rem;
            }
            
            .chart-subtitle {
                font-size: 0.9rem;
            }
            
            .bar-chart {
                width: 100%;
                overflow: visible;
                display: block; /* Changed from flex to block */
            }
            
            .bar-item {
                display: block; /* Changed from flex to block */
                width: 100%;
                background: white;
                border: 2px solid #e9ecef;
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
                box-sizing: border-box;
            }
            
            .bar-label {
                display: block;
                width: 100%;
                text-align: center;
                font-size: 1.1rem;
                font-weight: bold;
                color: #333;
                margin-bottom: 10px;
            }
            
            .bar-container {
                display: block;
                width: 100%;
                height: 30px;
                background-color: #f0f0f0;
                border-radius: 15px;
                position: relative;
                overflow: hidden;
                margin: 10px 0;
                box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .bar-fill {
                height: 100%;
                border-radius: 15px;
                position: relative;
                display: block;
                transition: width 1.5s ease-in-out;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                /* Width will be set by JavaScript - don't override here */
            }
            
            .bar-percentage {
                display: block;
                text-align: center;
                font-size: 1.2rem;
                font-weight: bold;
                color: #333;
                margin-top: 10px;
            }
            
            .risk-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .risk-card {
                padding: 20px;
            }
            
            .risk-percentage {
                font-size: 2rem;
            }
            
            .risk-icon {
                font-size: 2.5rem;
            }
            
            .modal-content {
                margin: 20% auto;
                padding: 15px;
                width: 95%;
            }
            
            .recommendations {
                padding: 15px;
            }
            
            .disease-recommendations {
                padding: 12px;
            }
            
            /* BMI ì…ë ¥ í•„ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            #bmi {
                width: 70px;
            }
            
            /* í˜ˆì•• ì…ë ¥ í•„ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .form-group div[style*="display: flex"] {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .form-group div[style*="display: flex"] input {
                min-width: 80px;
            }
        }

        /* ì‘ì€ ëª¨ë°”ì¼ í™”ë©´ (320px ì´í•˜) */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .form-container {
                padding: 15px;
            }
            
            .form-section {
                padding: 15px;
            }
            
            .btn {
                padding: 12px;
                font-size: 0.95rem;
            }
            
            .risk-percentage {
                font-size: 1.8rem;
            }
            
            .chart-title {
                font-size: 1rem;
            }
        }

        
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>3ëŒ€ ë§Œì„±ì§ˆí™˜ ìœ„í—˜ë„ ì˜ˆì¸¡</h1>
            <p>ê³ í˜ˆì••, ë‹¹ë‡¨ë³‘, ê³ ì§€í˜ˆì¦ ë°œìƒ ìœ„í—˜ì„ ë¯¸ë¦¬ ì˜ˆì¸¡í•˜ê³  ì˜ˆë°©í•˜ì„¸ìš”</p>
            <div class="save-status" id="saveStatus">ìë™ ì €ì¥ë¨ âœ“</div>
        </div>

        <div class="form-container">
            <form id="diseaseForm">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="form-section">
                    <h3>ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
                    <p class="required-notice">âš ï¸ <span style="color: red;">*</span> í‘œì‹œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">ì´ë¦„ <span style="color: red;">*</span></label>
                            <input type="text" id="name" name="name" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="form-group">
                            <label for="age">ì •í™•í•œ ë‚˜ì´ <span style="color: red;">*</span></label>
                            <input type="number" id="age" name="age" min="18" max="100" required placeholder="ì˜ˆ: 45">
                        </div>
                        <div class="form-group">
                            <label for="gender">ì„±ë³„ <span style="color: red;">*</span></label>
                            <select id="gender" name="gender" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="male">ë‚¨ì„±</option>
                                <option value="female">ì—¬ì„±</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="pregnancyGroup" style="display: none;">
                            <label for="pregnancy">ì„ì‹  ì—¬ë¶€</label>
                            <select id="pregnancy" name="pregnancy">
                                <option value="no">ì•„ë‹ˆì˜¤</option>
                                <option value="yes">ì˜ˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="occupation_activity">ì£¼ ì§ì—… í™œë™ëŸ‰</label>
                            <select id="occupation_activity" name="occupation_activity">
                                <option value="sedentary">ì£¼ë¡œ ì•‰ì•„ì„œ ì¼í•¨ (ì‚¬ë¬´ì§, ìš´ì „ì—… ë“±)</option>
                                <option value="moderate">ì¤‘ê°„ ì •ë„ í™œë™ (ì„œë¹„ìŠ¤ì—…, êµìœ¡ì—… ë“±)</option>
                                <option value="active">í™œë°œí•œ í™œë™ (íŒë§¤ì—…, ì˜ë£Œì—… ë“±)</option>
                                <option value="heavy">ìœ¡ì²´ ë…¸ë™ (ê±´ì„¤ì—…, ì œì¡°ì—… ë“±)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="health_perception">ë³¸ì¸ì˜ í˜„ì¬ ê±´ê°• ìƒíƒœ</label>
                            <select id="health_perception" name="health_perception">
                                <option value="excellent">ì•„ì£¼ ì¢‹ìŒ</option>
                                <option value="good">ì¢‹ìŒ</option>
                                <option value="fair">ë³´í†µ</option>
                                <option value="poor">ë‚˜ì¨</option>
                                <option value="very_poor">ë§¤ìš° ë‚˜ì¨</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ì‹ ì²´ ì§€í‘œ -->
                <div class="form-section">
                    <h3>ğŸ“ ì‹ ì²´ ì§€í‘œ</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="height">í‚¤ (cm) <span style="color: red;">*</span></label>
                            <input type="number" id="height" name="height" min="100" max="250" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">ëª¸ë¬´ê²Œ (kg) <span style="color: red;">*</span></label>
                            <input type="number" id="weight" name="weight" min="30" max="200" required>
                        </div>
                        <div class="form-group">
                            <label>BMI</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="text" id="bmi" name="bmi" readonly style="background: #f0f0f0;">
                                <span id="bmiInterpretation" style="font-weight: 600; padding: 5px 10px; border-radius: 15px; font-size: 0.9rem;"></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="waist">í—ˆë¦¬ë‘˜ë ˆ</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="number" id="waist" name="waist" min="10" max="200" placeholder="ìˆ«ì ì…ë ¥">
                                <select id="waist_unit" name="waist_unit" style="min-width: 80px;">
                                    <option value="cm">cm</option>
                                    <option value="inch">ì¸ì¹˜</option>
                                </select>
                                <button type="button" class="btn-unknown" onclick="setUnknown('waist')">ëª¨ë¦„</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>í˜ˆì•• (mmHg)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="number" id="systolic" name="systolic" min="80" max="250" placeholder="ìˆ˜ì¶•ê¸°">
                                <span>/</span>
                                <input type="number" id="diastolic" name="diastolic" min="40" max="150" placeholder="ì´ì™„ê¸°">
                                <button type="button" class="btn-unknown" onclick="setUnknown('blood_pressure')">ëª¨ë¦„</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="glucose">ê³µë³µí˜ˆë‹¹ (mg/dL)</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="glucose" name="glucose" min="60" max="300">
                                <button type="button" class="btn-unknown" onclick="setUnknown('glucose')">ëª¨ë¦„</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê°€ì¡±ë ¥ -->
                <div class="form-section">
                    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ë ¥</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>1ì„¸ëŒ€ (ë¶€ëª¨)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="parent_none" name="family_history" value="parent_none">
                                    <label for="parent_none">ì—†ìŒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="parent_hypertension" name="family_history" value="parent_hypertension">
                                    <label for="parent_hypertension">ê³ í˜ˆì••</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="parent_diabetes" name="family_history" value="parent_diabetes">
                                    <label for="parent_diabetes">ë‹¹ë‡¨ë³‘</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="parent_hyperlipidemia" name="family_history" value="parent_hyperlipidemia">
                                    <label for="parent_hyperlipidemia">ê³ ì§€í˜ˆì¦</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>2ì„¸ëŒ€ (ì¡°ë¶€ëª¨)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="grandparent_none" name="family_history" value="grandparent_none">
                                    <label for="grandparent_none">ì—†ìŒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="grandparent_hypertension" name="family_history" value="grandparent_hypertension">
                                    <label for="grandparent_hypertension">ê³ í˜ˆì••</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="grandparent_diabetes" name="family_history" value="grandparent_diabetes">
                                    <label for="grandparent_diabetes">ë‹¹ë‡¨ë³‘</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="grandparent_hyperlipidemia" name="family_history" value="grandparent_hyperlipidemia">
                                    <label for="grandparent_hyperlipidemia">ê³ ì§€í˜ˆì¦</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>í˜•ì œìë§¤</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="sibling_none" name="family_history" value="sibling_none">
                                    <label for="sibling_none">ì—†ìŒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="sibling_hypertension" name="family_history" value="sibling_hypertension">
                                    <label for="sibling_hypertension">ê³ í˜ˆì••</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="sibling_diabetes" name="family_history" value="sibling_diabetes">
                                    <label for="sibling_diabetes">ë‹¹ë‡¨ë³‘</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="sibling_hyperlipidemia" name="family_history" value="sibling_hyperlipidemia">
                                    <label for="sibling_hyperlipidemia">ê³ ì§€í˜ˆì¦</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìš´ë™ìŠµê´€ -->
                <div class="form-section">
                    <h3>ğŸƒâ€â™‚ï¸ ìš´ë™ ìŠµê´€</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="exercise_frequency">ì£¼ë‹¹ ìš´ë™ íšŸìˆ˜</label>
                            <select id="exercise_frequency" name="exercise_frequency">
                                <option value="0">ìš´ë™ ì•ˆí•¨</option>
                                <option value="1-2">1-2íšŒ</option>
                                <option value="3-4">3-4íšŒ</option>
                                <option value="5+">5íšŒ ì´ìƒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="exercise_intensity">ìš´ë™ ê°•ë„</label>
                            <select id="exercise_intensity" name="exercise_intensity">
                                <option value="low">ë‚®ìŒ (ì‚°ì±… ë“±)</option>
                                <option value="moderate">ë³´í†µ (ë¹ ë¥¸ ê±·ê¸°, ìˆ˜ì˜ ë“±)</option>
                                <option value="high">ë†’ìŒ (ë‹¬ë¦¬ê¸°, êµ¬ê¸°ìš´ë™ ë“±)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ì‹ì´ìŠµê´€ -->
                <div class="form-section">
                    <h3>ğŸ½ï¸ ì‹ì´ ìŠµê´€</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="meals_per_day">í•˜ë£¨ ì‹ì‚¬ íšŸìˆ˜</label>
                            <select id="meals_per_day" name="meals_per_day">
                                <option value="1">1íšŒ</option>
                                <option value="2">2íšŒ</option>
                                <option value="3">3íšŒ</option>
                                <option value="4+">4íšŒ ì´ìƒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="eating_out">ì£¼ë‹¹ ì™¸ì‹ íšŸìˆ˜</label>
                            <select id="eating_out" name="eating_out">
                                <option value="0">ê±°ì˜ ì•ˆí•¨</option>
                                <option value="1-3">1-3íšŒ</option>
                                <option value="4-6">4-6íšŒ</option>
                                <option value="7+">ë§¤ì¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="snack_frequency">í•˜ë£¨ ê°„ì‹ ì„­ì·¨ íšŸìˆ˜</label>
                            <select id="snack_frequency" name="snack_frequency">
                                <option value="0">ì•ˆ ë¨¹ìŒ</option>
                                <option value="1">1íšŒ</option>
                                <option value="2">2íšŒ</option>
                                <option value="3+">3íšŒ ì´ìƒ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì£¼ë¡œ ì„­ì·¨í•˜ëŠ” ê°„ì‹ ì¢…ë¥˜</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="snack_cookies" name="snack_types" value="cookies">
                                    <label for="snack_cookies">ê³¼ìë¥˜</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="snack_candy" name="snack_types" value="candy">
                                    <label for="snack_candy">ì‚¬íƒ•ë¥˜</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="snack_chocolate" name="snack_types" value="chocolate">
                                    <label for="snack_chocolate">ì´ˆì½œë¦¿ë¥˜</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="snack_bread" name="snack_types" value="bread">
                                    <label for="snack_bread">ë¹µë¥˜</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="snack_fruit" name="snack_types" value="fruit">
                                    <label for="snack_fruit">ê³¼ì¼ë¥˜</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="snack_nuts" name="snack_types" value="nuts">
                                    <label for="snack_nuts">ê²¬ê³¼ë¥˜</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì‹ì´ íŠ¹ì„±</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="high_sodium" name="diet_habits" value="high_sodium">
                                    <label for="high_sodium">ì§  ìŒì‹ ì„ í˜¸</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="high_sugar" name="diet_habits" value="high_sugar">
                                    <label for="high_sugar">ë‹¨ ìŒì‹ ì„ í˜¸</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="late_night_eating" name="diet_habits" value="late_night_eating">
                                    <label for="late_night_eating">ì•¼ì‹ ìŠµê´€</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="processed_food" name="diet_habits" value="processed_food">
                                    <label for="processed_food">ê°€ê³µì‹í’ˆ ìì£¼ ì„­ì·¨</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="soup_preference" name="diet_habits" value="soup_preference">
                                    <label for="soup_preference">êµ­ë¬¼ ìŒì‹ ì„ í˜¸</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fried_food" name="diet_habits" value="fried_food">
                                    <label for="fried_food">íŠ€ê¸´ ìŒì‹ ì„ í˜¸</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í¡ì—° ë° ìŒì£¼ -->
                <div class="form-section">
                    <h3>ğŸš¬ í¡ì—° ë° ìŒì£¼</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="smoking">í¡ì—° ìƒíƒœ</label>
                            <select id="smoking" name="smoking">
                                <option value="never">ë¹„í¡ì—°</option>
                                <option value="former">ê³¼ê±° í¡ì—°</option>
                                <option value="current">í˜„ì¬ í¡ì—°</option>
                            </select>
                        </div>
                        <div class="form-group" id="smokingAmountGroup" style="display: none;">
                            <label for="smoking_amount">í•˜ë£¨ í¡ì—°ëŸ‰ (ê°œë¹„)</label>
                            <input type="number" id="smoking_amount" name="smoking_amount" min="1" max="100">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="drinking">ìŒì£¼ ë¹ˆë„</label>
                            <select id="drinking" name="drinking">
                                <option value="never">ê¸ˆì£¼</option>
                                <option value="occasional">ê°€ë” (ì›” 1-2íšŒ)</option>
                                <option value="moderate">ë³´í†µ (ì£¼ 1-2íšŒ)</option>
                                <option value="frequent">ìì£¼ (ì£¼ 3íšŒ ì´ìƒ)</option>
                            </select>
                        </div>
                        <div class="form-group" id="drinkingDetailsGroup" style="display: none;">
                            <label for="drinking_type">ì£¼ë¡œ ë§ˆì‹œëŠ” ìˆ  ì¢…ë¥˜</label>
                            <select id="drinking_type" name="drinking_type">
                                <option value="soju">ì†Œì£¼</option>
                                <option value="beer">ë§¥ì£¼</option>
                                <option value="makgeolli">ë§‰ê±¸ë¦¬</option>
                                <option value="wine">ì™€ì¸</option>
                                <option value="cocktail">ì¹µí…Œì¼</option>
                                <option value="whiskey">ìœ„ìŠ¤í‚¤</option>
                                <option value="other">ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div class="form-group" id="drinkingAmountGroup" style="display: none;">
                            <label for="drinking_amount">ìŒì£¼ëŸ‰ (ì”/íšŒ)</label>
                            <input type="number" id="drinking_amount" name="drinking_amount" min="1" max="20" placeholder="ì˜ˆ) ì†Œì£¼ 3ì”">
                        </div>
                    </div>
                </div>

                <!-- ìˆ˜ë©´ íŒ¨í„´ -->
                <div class="form-section">
                    <h3>ğŸ˜´ ìˆ˜ë©´ íŒ¨í„´</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sleep_hours">í‰ê·  ìˆ˜ë©´ì‹œê°„</label>
                            <select id="sleep_hours" name="sleep_hours">
                                <option value="<6">6ì‹œê°„ ë¯¸ë§Œ</option>
                                <option value="6-8">6-8ì‹œê°„</option>
                                <option value=">8">8ì‹œê°„ ì´ˆê³¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sleep_quality">ìˆ˜ë©´ì˜ ì§ˆ ë§Œì¡±ë„</label>
                            <select id="sleep_quality" name="sleep_quality">
                                <option value="satisfied">ë§Œì¡±</option>
                                <option value="moderate">ë³´í†µ</option>
                                <option value="unsatisfied">ë¶ˆë§Œì¡±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sleep_interruption">ìˆ˜ë©´ ì¤‘ ê¹¨ëŠ” ë¹ˆë„</label>
                            <select id="sleep_interruption" name="sleep_interruption">
                                <option value="rarely">ê±°ì˜ ì—†ìŒ</option>
                                <option value="sometimes">ê°€ë”</option>
                                <option value="often">ìì£¼</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="daytime_sleepiness">ì£¼ê°„ ì¡¸ë¦¼</label>
                            <select id="daytime_sleepiness" name="daytime_sleepiness">
                                <option value="none">ì—†ìŒ</option>
                                <option value="mild">ì•½ê°„</option>
                                <option value="severe">ë§¤ìš° ì¡¸ë¦¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sleep_regularity">ìˆ˜ë©´ ê·œì¹™ì„±</label>
                            <select id="sleep_regularity" name="sleep_regularity">
                                <option value="regular">ê·œì¹™ì </option>
                                <option value="irregular">ë¶ˆê·œì¹™</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="insomnia_diagnosis">ë¶ˆë©´ì¦ ì§„ë‹¨ ê²½í—˜</label>
                            <select id="insomnia_diagnosis" name="insomnia_diagnosis">
                                <option value="no">ì•„ë‹ˆì˜¤</option>
                                <option value="yes">ì˜ˆ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ -->
                <div class="form-section">
                    <h3>ğŸ˜° ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stress_level">ì „ë°˜ì  ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€</label>
                            <select id="stress_level" name="stress_level">
                                <option value="low">ë‚®ìŒ</option>
                                <option value="moderate">ë³´í†µ</option>
                                <option value="high">ë†’ìŒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="stress_duration">ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ì† ê¸°ê°„</label>
                            <select id="stress_duration" name="stress_duration">
                                <option value="<1week">1ì£¼ ë¯¸ë§Œ</option>
                                <option value="1week+">1ì£¼ ì´ìƒ</option>
                                <option value="1month+">1ê°œì›” ì´ìƒ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì£¼ìš” ìŠ¤íŠ¸ë ˆìŠ¤ ì›ì¸ (ë³µìˆ˜ì„ íƒ ê°€ëŠ¥)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_work" name="stress_causes" value="work">
                                    <label for="stress_work">ì§ì¥/í•™ì—…</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_relationship" name="stress_causes" value="relationship">
                                    <label for="stress_relationship">ì¸ê°„ê´€ê³„</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_financial" name="stress_causes" value="financial">
                                    <label for="stress_financial">ê²½ì œì  ë¬¸ì œ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_health" name="stress_causes" value="health">
                                    <label for="stress_health">ê±´ê°• ë¬¸ì œ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_childcare" name="stress_causes" value="childcare">
                                    <label for="stress_childcare">ìœ¡ì•„</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_other" name="stress_causes" value="other">
                                    <label for="stress_other">ê¸°íƒ€</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ë°©ë²• (ë³µìˆ˜ì„ íƒ ê°€ëŠ¥)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_relief_exercise" name="stress_relief" value="exercise">
                                    <label for="stress_relief_exercise">ìš´ë™</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_relief_hobby" name="stress_relief" value="hobby">
                                    <label for="stress_relief_hobby">ì·¨ë¯¸í™œë™</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_relief_meditation" name="stress_relief" value="meditation">
                                    <label for="stress_relief_meditation">ëª…ìƒ/ìš”ê°€</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_relief_social" name="stress_relief" value="social">
                                    <label for="stress_relief_social">ì‚¬ëŒë“¤ê³¼ ë§Œë‚¨</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stress_relief_none" name="stress_relief" value="none">
                                    <label for="stress_relief_none">íŠ¹ë³„í•œ ë°©ë²• ì—†ìŒ</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì§ˆë³‘ ê³¼ê±°ë ¥ -->
                <div class="form-section">
                    <h3>ğŸ¥ ì§ˆë³‘ ê³¼ê±°ë ¥</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>3ëŒ€ ë§Œì„±ì§ˆí™˜ ì§„ë‹¨ ê²½í—˜</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="past_chronic_none" name="past_chronic_diseases" value="none">
                                    <label for="past_chronic_none">ì—†ìŒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="past_hypertension" name="past_chronic_diseases" value="hypertension">
                                    <label for="past_hypertension">ê³ í˜ˆì••</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="past_diabetes" name="past_chronic_diseases" value="diabetes">
                                    <label for="past_diabetes">ë‹¹ë‡¨ë³‘</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="past_hyperlipidemia" name="past_chronic_diseases" value="hyperlipidemia">
                                    <label for="past_hyperlipidemia">ê³ ì§€í˜ˆì¦</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì‹¬í˜ˆê´€ ì§ˆí™˜ ê´€ë ¨ ì§„ë‹¨ ê²½í—˜</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="cardiovascular_none" name="cardiovascular_diseases" value="none">
                                    <label for="cardiovascular_none">ì—†ìŒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="angina" name="cardiovascular_diseases" value="angina">
                                    <label for="angina">í˜‘ì‹¬ì¦</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="myocardial_infarction" name="cardiovascular_diseases" value="myocardial_infarction">
                                    <label for="myocardial_infarction">ì‹¬ê·¼ê²½ìƒ‰</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="stroke" name="cardiovascular_diseases" value="stroke">
                                    <label for="stroke">ë‡Œì¡¸ì¤‘</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ê¸°íƒ€ ê´€ë ¨ ì§ˆí™˜</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="other_none" name="other_diseases" value="none">
                                    <label for="other_none">ì—†ìŒ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fatty_liver" name="other_diseases" value="fatty_liver">
                                    <label for="fatty_liver">ì§€ë°©ê°„ (ë¹„ì•Œì½”ì˜¬ì„± í¬í•¨)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="thyroid" name="other_diseases" value="thyroid">
                                    <label for="thyroid">ê°‘ìƒì„  ì§ˆí™˜</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="sleep_apnea" name="other_diseases" value="sleep_apnea">
                                    <label for="sleep_apnea">ìˆ˜ë©´ë¬´í˜¸í¡ì¦</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="depression" name="other_diseases" value="depression">
                                    <label for="depression">ìš°ìš¸ì¦/ë¶ˆì•ˆì¥ì• </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="autoimmune" name="other_diseases" value="autoimmune">
                                    <label for="autoimmune">ìê°€ë©´ì—­/ë¥˜ë§ˆí‹°ìŠ¤ ì§ˆí™˜</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row" id="femaleSpecificDiseases" style="display: none;">
                        <div class="form-group">
                            <label>ì—¬ì„± íŠ¹í™” ì§ˆí™˜</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="gestational_diabetes" name="female_diseases" value="gestational_diabetes">
                                    <label for="gestational_diabetes">ì„ì‹ ì„± ë‹¹ë‡¨</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pcos" name="female_diseases" value="pcos">
                                    <label for="pcos">ë‹¤ë‚­ì„±ë‚œì†Œì¦í›„êµ°</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button type="button" class="btn btn-primary" onclick="calculateRisk()">ìœ„í—˜ë„ ì˜ˆì¸¡í•˜ê¸°</button>
                    <button type="button" class="btn btn-secondary" onclick="confirmReset()">ë‹¤ì‹œí•˜ê¸°</button>
                </div>
            </form>

            <div id="resultsContainer">
                <div class="results" id="results">
                    <!-- ì°¨íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <!-- PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ê²°ê³¼ ì˜ì—­ ì™¸ë¶€) -->
                <div id="downloadButtonContainer" style="display: none; text-align: center; margin-top: 20px; padding: 20px;">
                    <button class="btn btn-download" onclick="downloadPDF()">ğŸ“„ ê²°ê³¼ PDF ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>âš ï¸ í™•ì¸</h3>
            <p>ì •ë§ ëª¨ë“  ì…ë ¥ ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">ì €ì¥ëœ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.</p>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal()" style="margin-right: 10px;">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="resetForm()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let saveTimer = null;
        const STORAGE_KEY = 'chronicDiseaseFormData';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadFormData();
            setupAutoSave();
            setupEventListeners();
        });

        // 1. ì¤‘ê°„ ì €ì¥ ê¸°ëŠ¥
        function saveFormData() {
            const formData = new FormData(document.getElementById('diseaseForm'));
            const data = {};
            
            // ì¼ë°˜ input ë°ì´í„° ìˆ˜ì§‘
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // ì²´í¬ë°•ìŠ¤ ë°ì´í„° ìˆ˜ì§‘
            const checkboxGroups = [
                'family_history', 'snack_types', 'diet_habits', 'stress_causes', 
                'stress_relief', 'past_chronic_diseases', 'cardiovascular_diseases', 
                'other_diseases', 'female_diseases'
            ];

            checkboxGroups.forEach(group => {
                data[group] = Array.from(document.querySelectorAll(`input[name="${group}"]:checked`))
                    .map(cb => cb.value);
            });

            // ë¹„í™œì„±í™”ëœ í•„ë“œ ìƒíƒœ ì €ì¥
            data._disabledFields = {
                waist: document.getElementById('waist').disabled,
                systolic: document.getElementById('systolic').disabled,
                diastolic: document.getElementById('diastolic').disabled,
                glucose: document.getElementById('glucose').disabled
            };

            // localStorageì— ì €ì¥
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                showSaveStatus();
            } catch (e) {
                console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', e);
            }
        }

        function loadFormData() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (!savedData) return;

                const data = JSON.parse(savedData);
                
                // ì¼ë°˜ í•„ë“œ ë³µì›
                Object.keys(data).forEach(key => {
                    if (key.startsWith('_')) return; // ë©”íƒ€ë°ì´í„° ìŠ¤í‚µ
                    
                    const element = document.getElementById(key) || document.querySelector(`[name="${key}"]`);
                    if (element) {
                        if (element.type === 'checkbox' || element.type === 'radio') {
                            element.checked = Array.isArray(data[key]) ? 
                                data[key].includes(element.value) : data[key] === element.value;
                        } else {
                            element.value = Array.isArray(data[key]) ? data[key][0] : data[key];
                        }
                    }
                });

                // ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ ë³µì›
                if (data.family_history) {
                    data.family_history.forEach(value => {
                        const cb = document.querySelector(`input[name="family_history"][value="${value}"]`);
                        if (cb) cb.checked = true;
                    });
                }

                ['snack_types', 'diet_habits', 'stress_causes', 'stress_relief', 
                 'past_chronic_diseases', 'cardiovascular_diseases', 'other_diseases', 'female_diseases'].forEach(group => {
                    if (data[group]) {
                        data[group].forEach(value => {
                            const cb = document.querySelector(`input[name="${group}"][value="${value}"]`);
                            if (cb) cb.checked = true;
                        });
                    }
                });

                // ë¹„í™œì„±í™”ëœ í•„ë“œ ìƒíƒœ ë³µì›
                if (data._disabledFields) {
                    Object.keys(data._disabledFields).forEach(field => {
                        if (data._disabledFields[field]) {
                            const element = document.getElementById(field);
                            if (element) element.disabled = true;
                        }
                    });
                }

                // ì¡°ê±´ë¶€ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
                handleConditionalFields();
                calculateBMI();
            } catch (e) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }

        function setupAutoSave() {
            // ëª¨ë“  ì…ë ¥ í•„ë“œì— ìë™ ì €ì¥ ì´ë²¤íŠ¸ ì¶”ê°€
            const form = document.getElementById('diseaseForm');
            form.addEventListener('input', debounce(saveFormData, 1000));
            form.addEventListener('change', debounce(saveFormData, 1000));
        }

        function debounce(func, wait) {
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(saveTimer);
                    func(...args);
                };
                clearTimeout(saveTimer);
                saveTimer = setTimeout(later, wait);
            };
        }

        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 2000);
        }

        // 2. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ì„±ë³„ ì„ íƒ ì‹œ ì¡°ê±´ë¶€ í•„ë“œ í‘œì‹œ
            document.getElementById('gender').addEventListener('change', handleConditionalFields);
            
            // í¡ì—° ìƒíƒœ ë³€ê²½ ì‹œ
            document.getElementById('smoking').addEventListener('change', handleConditionalFields);
            
            // ìŒì£¼ ë¹ˆë„ ë³€ê²½ ì‹œ
            document.getElementById('drinking').addEventListener('change', handleConditionalFields);
            
            // BMI ìë™ ê³„ì‚°
            document.getElementById('height').addEventListener('input', calculateBMI);
            document.getElementById('weight').addEventListener('input', calculateBMI);
        }

        function handleConditionalFields() {
            const gender = document.getElementById('gender').value;
            const smoking = document.getElementById('smoking').value;
            const drinking = document.getElementById('drinking').value;

            // ì„ì‹  ì—¬ë¶€ ë° ì—¬ì„± íŠ¹í™” ì§ˆí™˜
            document.getElementById('pregnancyGroup').style.display = 
                gender === 'female' ? 'block' : 'none';
            document.getElementById('femaleSpecificDiseases').style.display = 
                gender === 'female' ? 'block' : 'none';

            // í¡ì—°ëŸ‰
            document.getElementById('smokingAmountGroup').style.display = 
                (smoking === 'former' || smoking === 'current') ? 'block' : 'none';

            // ìŒì£¼ ê´€ë ¨
            const showDrinking = drinking !== 'never';
            document.getElementById('drinkingDetailsGroup').style.display = 
                showDrinking ? 'block' : 'none';
            document.getElementById('drinkingAmountGroup').style.display = 
                showDrinking ? 'block' : 'none';
        }

        // BMI ê³„ì‚° ë° í•´ì„
        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const bmiField = document.getElementById('bmi');
            const bmiInterpretation = document.getElementById('bmiInterpretation');
            
            if (height && weight) {
                const bmi = weight / ((height / 100) ** 2);
                bmiField.value = bmi.toFixed(1);
                
                let interpretation = '';
                let className = '';
                
                if (bmi < 18.5) {
                    interpretation = 'ì €ì²´ì¤‘';
                    className = 'low-risk';
                } else if (bmi < 23) {
                    interpretation = 'ì •ìƒ';
                    className = 'low-risk';
                } else if (bmi < 25) {
                    interpretation = 'ê³¼ì²´ì¤‘';
                    className = 'moderate-risk';
                } else if (bmi < 30) {
                    interpretation = 'ë¹„ë§Œ';
                    className = 'high-risk';
                } else {
                    interpretation = 'ê³ ë„ë¹„ë§Œ';
                    className = 'high-risk';
                }
                
                bmiInterpretation.textContent = interpretation;
                bmiInterpretation.className = className;
            } else {
                bmiField.value = '';
                bmiInterpretation.textContent = '';
                bmiInterpretation.className = '';
            }
        }

        // 'ëª¨ë¦„' ë²„íŠ¼ ì²˜ë¦¬
        function setUnknown(fieldType) {
            switch(fieldType) {
                case 'waist':
                    document.getElementById('waist').value = '';
                    document.getElementById('waist').disabled = true;
                    break;
                case 'blood_pressure':
                    document.getElementById('systolic').value = '';
                    document.getElementById('diastolic').value = '';
                    document.getElementById('systolic').disabled = true;
                    document.getElementById('diastolic').disabled = true;
                    break;
                case 'glucose':
                    document.getElementById('glucose').value = '';
                    document.getElementById('glucose').disabled = true;
                    break;
            }
            saveFormData(); // ìƒíƒœ ì €ì¥
        }

        // 3. ë¦¬ì…‹ í™•ì¸ ê¸°ëŠ¥
        function confirmReset() {
            document.getElementById('confirmModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function resetForm() {
            // localStorage ë°ì´í„° ì‚­ì œ
            localStorage.removeItem(STORAGE_KEY);
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('diseaseForm').reset();
            
            // ì¡°ê±´ë¶€ í•„ë“œ ìˆ¨ê¹€
            document.getElementById('pregnancyGroup').style.display = 'none';
            document.getElementById('femaleSpecificDiseases').style.display = 'none';
            document.getElementById('smokingAmountGroup').style.display = 'none';
            document.getElementById('drinkingDetailsGroup').style.display = 'none';
            document.getElementById('drinkingAmountGroup').style.display = 'none';
            
            // ê²°ê³¼ ìˆ¨ê¹€
            document.getElementById('results').style.display = 'none';
            
            // PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìˆ¨ê¹€
            document.getElementById('downloadButtonContainer').style.display = 'none';
            
            // ë¹„í™œì„±í™”ëœ í•„ë“œ ì¬í™œì„±í™”
            ['waist', 'systolic', 'diastolic', 'glucose'].forEach(field => {
                document.getElementById(field).disabled = false;
            });
            
            // BMI ì´ˆê¸°í™”
            document.getElementById('bmi').value = '';
            document.getElementById('bmiInterpretation').textContent = '';
            document.getElementById('bmiInterpretation').className = '';
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeModal();
            
            // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 4. ìœ„í—˜ë„ ê³„ì‚° (ê°œì„ ëœ ë¡œì§)
        function calculateRisk() {
            const formData = new FormData(document.getElementById('diseaseForm'));
            const data = {};
            
            // ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // ì²´í¬ë°•ìŠ¤ ë°ì´í„° ìˆ˜ì§‘
            const checkboxGroups = [
                'family_history', 'snack_types', 'diet_habits', 'stress_causes', 
                'stress_relief', 'past_chronic_diseases', 'cardiovascular_diseases', 
                'other_diseases', 'female_diseases'
            ];

            checkboxGroups.forEach(group => {
                data[group] = Array.from(document.querySelectorAll(`input[name="${group}"]:checked`))
                    .map(cb => cb.value);
            });

            console.log('=== ì…ë ¥ ë°ì´í„° í™•ì¸ ===');
            console.log('ë‚˜ì´:', data.age);
            console.log('ì„±ë³„:', data.gender);
            console.log('í‚¤/ëª¸ë¬´ê²Œ:', data.height, data.weight);

            // ìœ„í—˜ë„ ê³„ì‚°
            const risks = calculateDiseaseRisks(data);
            
            console.log('=== calculateRisk ìµœì¢… í™•ì¸ ===');
            console.log('risks ê°ì²´:', risks);
            console.log('ê³ ì§€í˜ˆì¦ ê°’ ì¡´ì¬ ì—¬ë¶€:', 'hyperlipidemia' in risks);
            console.log('ê³ ì§€í˜ˆì¦ ê°’:', risks.hyperlipidemia);
            
            // BMI ê³„ì‚°
            const bmi = data.height && data.weight ? 
                (parseFloat(data.weight) / ((parseFloat(data.height) / 100) ** 2)).toFixed(1) : null;
            
            // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
            const userData = {
                name: data.name || `${data.age}ì„¸ ${data.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}`, // ì´ë¦„ ì…ë ¥ê°’ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
                age: parseInt(data.age),
                gender: data.gender,
                bmi: parseFloat(bmi),
                hypertension: Math.round(risks.hypertension),
                diabetes: Math.round(risks.diabetes),
                dyslipidemia: Math.round(risks.hyperlipidemia),
            };
            
            console.log('ì„œë²„ ì „ì†¡ ë°ì´í„°:', userData);
            sendRiskToServer(userData);
            
            // ê²°ê³¼ í‘œì‹œ
            displayResults(risks, data);
            
            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            
            // ì¶”ê°€: bar-fill ì§ì ‘ ì„¤ì •
            document.querySelectorAll('.bar-fill').forEach(bar => {
                const targetWidth = bar.getAttribute('data-width');
                bar.style.width = '0';
                void bar.offsetWidth;
                bar.style.width = targetWidth;
            });
        }

        function calculateDiseaseRisks(data) {
            const hypertensionRisk = calculateHypertensionRisk(data);
            const diabetesRisk = calculateDiabetesRisk(data);
            const hyperlipidemiaRisk = calculateHyperlipidemiaRisk(data);
            
            console.log('=== ìœ„í—˜ë„ ê³„ì‚° ê²°ê³¼ ===');
            console.log('ê³ í˜ˆì•• ìœ„í—˜ë„:', hypertensionRisk);
            console.log('ë‹¹ë‡¨ë³‘ ìœ„í—˜ë„:', diabetesRisk);
            console.log('ê³ ì§€í˜ˆì¦ ìœ„í—˜ë„:', hyperlipidemiaRisk);
            
            const risks = {
                hypertension: hypertensionRisk,
                diabetes: diabetesRisk,
                hyperlipidemia: hyperlipidemiaRisk
            };
            
            console.log('ìµœì¢… risks ê°ì²´:', risks);
            return risks;
        }

        // // ê°œì„ ëœ ê³ í˜ˆì•• ìœ„í—˜ë„ ê³„ì‚°
        // function calculateHypertensionRisk(data) {
        //     let baseRisk = getBaseRiskByAge(parseInt(data.age), 'hypertension');
        //     let riskMultiplier = 1.0;

        //     // ì„±ë³„ ìš”ì¸
        //     if (data.gender === 'male') {
        //         riskMultiplier *= 1.2;
        //     }

        //     // BMIì™€ í—ˆë¦¬ë‘˜ë ˆ ì‹œë„ˆì§€ íš¨ê³¼
        //     const bmiRisk = getBMIRiskMultiplier(data);
        //     const waistRisk = getWaistRiskMultiplier(data);
            
        //     if (bmiRisk > 1.3 && waistRisk > 1.3) {
        //         riskMultiplier *= bmiRisk * waistRisk * 1.2; // ì‹œë„ˆì§€ ê°€ì¤‘ì¹˜
        //     } else {
        //         riskMultiplier *= Math.max(bmiRisk, waistRisk);
        //     }

        //     // í˜ˆì•• ìˆ˜ì¹˜
        //     if (data.systolic && data.diastolic) {
        //         const systolic = parseFloat(data.systolic);
        //         const diastolic = parseFloat(data.diastolic);
        //         if (systolic >= 140 || diastolic >= 90) {
        //             return 90; // ì´ë¯¸ ê³ í˜ˆì•• ì§„ë‹¨ ê¸°ì¤€
        //         } else if (systolic >= 130 || diastolic >= 85) {
        //             riskMultiplier *= 2.5;
        //         } else if (systolic >= 120 || diastolic >= 80) {
        //             riskMultiplier *= 1.5;
        //         }
        //     }

        //     // ê°€ì¡±ë ¥ê³¼ ê³¼ê±°ë ¥ êµì°¨ íš¨ê³¼
        //     const familyRisk = getFamilyHistoryRisk(data.family_history, 'hypertension');
        //     const pastRisk = data.past_chronic_diseases.includes('hypertension') ? 10.0 : 1.0;
            
        //     if (familyRisk > 1.5 && pastRisk > 1.0) {
        //         riskMultiplier *= familyRisk * pastRisk * 1.3; // êµì°¨ ê°€ì¤‘ì¹˜
        //     } else {
        //         riskMultiplier *= familyRisk * pastRisk;
        //     }

        //     // ì§ì—… í™œë™ëŸ‰
        //     const occupationMultiplier = {
        //         'sedentary': 1.3,
        //         'moderate': 1.1,
        //         'active': 0.9,
        //         'heavy': 0.8
        //     };
        //     riskMultiplier *= occupationMultiplier[data.occupation_activity] || 1.0;

        //     // ì£¼ê´€ì  ê±´ê°• ì¸ì‹
        //     const healthPerceptionMultiplier = {
        //         'excellent': 0.8,
        //         'good': 0.9,
        //         'fair': 1.0,
        //         'poor': 1.3,
        //         'very_poor': 1.6
        //     };
        //     riskMultiplier *= healthPerceptionMultiplier[data.health_perception] || 1.0;

        //     // ìˆ˜ë©´ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ êµì°¨ íš¨ê³¼
        //     const sleepStressRisk = getSleepStressRisk(data);
        //     riskMultiplier *= sleepStressRisk;

        //     // ìƒí™œìŠµê´€ ìš”ì¸ë“¤
        //     riskMultiplier *= getLifestyleRisk(data, 'hypertension');

        //     // ì§ˆë³‘ ê³¼ê±°ë ¥
        //     if (data.cardiovascular_diseases.length > 0) {
        //         riskMultiplier *= 3.0;
        //     }
        //     if (data.other_diseases.includes('sleep_apnea')) {
        //         riskMultiplier *= 2.0;
        //     }
        //     if (data.other_diseases.includes('fatty_liver')) {
        //         riskMultiplier *= 1.4;
        //     }

        //     return Math.min(baseRisk * riskMultiplier, 90);
        // }
        function calculateHypertensionRisk(data) {
            // Base on Framingham Hypertension Risk Score methodology
            // Uses additive risk points system rather than multiplicative
            
            let riskPoints = 0;
            const age = parseInt(data.age);
            const gender = data.gender;
            
            // Age points (based on Framingham methodology)
            if (age >= 20 && age < 30) riskPoints += 0;
            else if (age >= 30 && age < 40) riskPoints += 2;
            else if (age >= 40 && age < 50) riskPoints += 4;
            else if (age >= 50 && age < 60) riskPoints += 6;
            else if (age >= 60 && age < 70) riskPoints += 8;
            else if (age >= 70) riskPoints += 10;
            
            // Gender points
            if (gender === 'male') riskPoints += 1;
            
            // BMI points
            const bmi = getBMIValue(data);
            if (bmi >= 30) riskPoints += 3;
            else if (bmi >= 25) riskPoints += 2;
            else if (bmi < 18.5) riskPoints += 1;
            
            // Blood pressure points (major predictor)
            if (data.systolic && data.diastolic && !document.getElementById('systolic').disabled) {
                const systolic = parseFloat(data.systolic);
                const diastolic = parseFloat(data.diastolic);
                
                // Pre-hypertension ranges
                if (systolic >= 130 || diastolic >= 85) riskPoints += 4;
                else if (systolic >= 120 || diastolic >= 80) riskPoints += 2;
            }
            
            // Family history points
            if (data.family_history.includes('parent_hypertension')) riskPoints += 3;
            if (data.family_history.includes('grandparent_hypertension')) riskPoints += 1;
            if (data.family_history.includes('sibling_hypertension')) riskPoints += 2;
            
            // Lifestyle factors (smaller impact)
            if (data.smoking === 'current') riskPoints += 2;
            if (data.exercise_frequency === '0') riskPoints += 2;
            if (data.diet_habits.includes('high_sodium')) riskPoints += 2;
            if (data.stress_level === 'high') riskPoints += 1;
            
            // Sleep factors
            let sleepIssues = 0;
            if (data.sleep_hours === '<6' || data.sleep_hours === '>8') sleepIssues++;
            if (data.sleep_quality === 'unsatisfied') sleepIssues++;
            if (sleepIssues >= 2) riskPoints += 1;
            
            // Medical history
            if (data.other_diseases.includes('sleep_apnea')) riskPoints += 2;
            if (data.other_diseases.includes('fatty_liver')) riskPoints += 1;
            
            // Convert points to percentage using validated ranges
            // Based on real-world hypertension incidence rates
            let riskPercentage = 0;
            
            if (riskPoints <= 5) riskPercentage = Math.min(riskPoints * 2, 8); // 0-8%
            else if (riskPoints <= 10) riskPercentage = 8 + (riskPoints - 5) * 3; // 8-23%
            else if (riskPoints <= 15) riskPercentage = 23 + (riskPoints - 10) * 4; // 23-43%
            else riskPercentage = Math.min(43 + (riskPoints - 15) * 3, 75); // 43-75% max
            
            return Math.min(riskPercentage, 75); // Cap at 75% to match real-world data
        }

        function getBMIValue(data) {
            if (!data.height || !data.weight) return 22; // Assume normal if unknown
            return parseFloat(data.weight) / ((parseFloat(data.height) / 100) ** 2);
        }

        // // ê°œì„ ëœ ë‹¹ë‡¨ë³‘ ìœ„í—˜ë„ ê³„ì‚°
        // function calculateDiabetesRisk(data) {
        //     let baseRisk = getBaseRiskByAge(parseInt(data.age), 'diabetes');
        //     let riskMultiplier = 1.0;

        //     // BMIì™€ í—ˆë¦¬ë‘˜ë ˆ ì‹œë„ˆì§€ íš¨ê³¼
        //     const bmiRisk = getBMIRiskMultiplier(data);
        //     const waistRisk = getWaistRiskMultiplier(data);
            
        //     if (bmiRisk > 1.5 && waistRisk > 1.5) {
        //         riskMultiplier *= bmiRisk * waistRisk * 1.3; // ë‹¹ë‡¨ëŠ” ë³µë¶€ë¹„ë§Œì— ë” ë¯¼ê°
        //     } else {
        //         riskMultiplier *= Math.max(bmiRisk, waistRisk);
        //     }

        //     // ê³µë³µí˜ˆë‹¹
        //     if (data.glucose) {
        //         const glucose = parseFloat(data.glucose);
        //         if (glucose >= 126) {
        //             return 90; // ì´ë¯¸ ë‹¹ë‡¨ ì§„ë‹¨ ê¸°ì¤€
        //         } else if (glucose >= 100) {
        //             riskMultiplier *= 3.0; // ë‹¹ë‡¨ ì „ë‹¨ê³„
        //         }
        //     }

        //     // ê°€ì¡±ë ¥ê³¼ ê³¼ê±°ë ¥ êµì°¨ íš¨ê³¼
        //     const familyRisk = getFamilyHistoryRisk(data.family_history, 'diabetes');
        //     const pastRisk = data.past_chronic_diseases.includes('diabetes') ? 10.0 : 1.0;
            
        //     if (familyRisk > 1.5 && pastRisk > 1.0) {
        //         riskMultiplier *= familyRisk * pastRisk * 1.4;
        //     } else {
        //         riskMultiplier *= familyRisk * pastRisk;
        //     }

        //     // ì§ì—… í™œë™ëŸ‰ (ë‹¹ë‡¨ëŠ” í™œë™ëŸ‰ì— ë” ë¯¼ê°)
        //     const occupationMultiplier = {
        //         'sedentary': 1.5,
        //         'moderate': 1.2,
        //         'active': 0.8,
        //         'heavy': 0.7
        //     };
        //     riskMultiplier *= occupationMultiplier[data.occupation_activity] || 1.0;

        //     // ì£¼ê´€ì  ê±´ê°• ì¸ì‹
        //     const healthPerceptionMultiplier = {
        //         'excellent': 0.7,
        //         'good': 0.9,
        //         'fair': 1.0,
        //         'poor': 1.4,
        //         'very_poor': 1.8
        //     };
        //     riskMultiplier *= healthPerceptionMultiplier[data.health_perception] || 1.0;

        //     // ìˆ˜ë©´ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ êµì°¨ íš¨ê³¼
        //     riskMultiplier *= getSleepStressRisk(data);

        //     // ìƒí™œìŠµê´€ ìš”ì¸ë“¤
        //     riskMultiplier *= getLifestyleRisk(data, 'diabetes');

        //     // ì§ˆë³‘ ê³¼ê±°ë ¥
        //     if (data.female_diseases.includes('gestational_diabetes')) {
        //         riskMultiplier *= 3.0;
        //     }
        //     if (data.female_diseases.includes('pcos')) {
        //         riskMultiplier *= 2.0;
        //     }
        //     if (data.other_diseases.includes('thyroid')) {
        //         riskMultiplier *= 1.5;
        //     }
        //     if (data.other_diseases.includes('fatty_liver')) {
        //         riskMultiplier *= 1.8;
        //     }

        //     return Math.min(baseRisk * riskMultiplier, 90);
        // }

        function calculateDiabetesRisk(data) {
            // Based on validated diabetes risk assessment tools (ADA Risk Calculator, Finnish Diabetes Risk Score)
            
            let riskPoints = 0;
            const age = parseInt(data.age);
            const gender = data.gender;
            
            // Age points (diabetes risk increases more gradually than hypertension)
            if (age >= 20 && age < 35) riskPoints += 0;
            else if (age >= 35 && age < 45) riskPoints += 1;
            else if (age >= 45 && age < 55) riskPoints += 3;
            else if (age >= 55 && age < 65) riskPoints += 5;
            else if (age >= 65) riskPoints += 7;
            
            // BMI is the strongest predictor for diabetes
            const bmi = getBMIValue(data);
            if (bmi >= 35) riskPoints += 5;
            else if (bmi >= 30) riskPoints += 4;
            else if (bmi >= 25) riskPoints += 2;
            else if (bmi < 18.5) riskPoints += 1; // Underweight can indicate other health issues
            
            // Waist circumference (strong predictor for diabetes)
            if (data.waist && !document.getElementById('waist').disabled) {
                let waistCm = parseFloat(data.waist);
                if (data.waist_unit === 'inch') waistCm *= 2.54;
                
                const threshold = gender === 'male' ? 102 : 88; // Clinical thresholds for diabetes risk
                if (waistCm >= threshold + 10) riskPoints += 3;
                else if (waistCm >= threshold) riskPoints += 2;
            }
            
            // Glucose levels (major predictor)
            if (data.glucose && !document.getElementById('glucose').disabled) {
                const glucose = parseFloat(data.glucose);
                if (glucose >= 110) riskPoints += 4; // Prediabetes range
                else if (glucose >= 100) riskPoints += 2; // Impaired fasting glucose
            }
            
            // Family history (strong genetic component for diabetes)
            if (data.family_history.includes('parent_diabetes')) riskPoints += 4;
            if (data.family_history.includes('grandparent_diabetes')) riskPoints += 2;
            if (data.family_history.includes('sibling_diabetes')) riskPoints += 3;
            
            // Gender-specific factors
            if (gender === 'female') {
                if (data.female_diseases.includes('gestational_diabetes')) riskPoints += 5;
                if (data.female_diseases.includes('pcos')) riskPoints += 3;
            }
            
            // Lifestyle factors
            if (data.exercise_frequency === '0') riskPoints += 2;
            if (data.diet_habits.includes('high_sugar')) riskPoints += 2;
            if (data.diet_habits.includes('processed_food')) riskPoints += 1;
            
            // Medical conditions
            if (data.other_diseases.includes('fatty_liver')) riskPoints += 2;
            if (data.other_diseases.includes('sleep_apnea')) riskPoints += 1;
            if (data.cardiovascular_diseases.length > 0) riskPoints += 2;
            
            // Occupation and stress (smaller impact)
            if (data.occupation_activity === 'sedentary') riskPoints += 1;
            if (data.stress_level === 'high' && data.stress_duration === '1month+') riskPoints += 1;
            
            // Convert points to percentage using validated diabetes incidence rates
            let riskPercentage = 0;
            
            if (riskPoints <= 4) riskPercentage = Math.min(riskPoints * 1.5, 6); // 0-6%
            else if (riskPoints <= 8) riskPercentage = 6 + (riskPoints - 4) * 2.5; // 6-16%
            else if (riskPoints <= 12) riskPercentage = 16 + (riskPoints - 8) * 3; // 16-28%
            else if (riskPoints <= 16) riskPercentage = 28 + (riskPoints - 12) * 4; // 28-44%
            else riskPercentage = Math.min(44 + (riskPoints - 16) * 3, 65); // 44-65% max
            
            return Math.min(riskPercentage, 65); // Cap at 65% based on real-world data
        }

        // ê°œì„ ëœ ê³ ì§€í˜ˆì¦ ìœ„í—˜ë„ ê³„ì‚°
        // function calculateHyperlipidemiaRisk(data) {
        //     let baseRisk = getBaseRiskByAge(parseInt(data.age), 'hyperlipidemia');
        //     let riskMultiplier = 1.0;

        //     // ì„±ë³„ ìš”ì¸
        //     if (data.gender === 'male') {
        //         riskMultiplier *= 1.3;
        //     }

        //     // BMIì™€ í—ˆë¦¬ë‘˜ë ˆ
        //     const bmiRisk = getBMIRiskMultiplier(data);
        //     const waistRisk = getWaistRiskMultiplier(data);
        //     riskMultiplier *= Math.max(bmiRisk, waistRisk);

        //     // ê°€ì¡±ë ¥
        //     riskMultiplier *= getFamilyHistoryRisk(data.family_history, 'hyperlipidemia');

        //     // ì§ì—… í™œë™ëŸ‰
        //     const occupationMultiplier = {
        //         'sedentary': 1.4,
        //         'moderate': 1.1,
        //         'active': 0.9,
        //         'heavy': 0.8
        //     };
        //     riskMultiplier *= occupationMultiplier[data.occupation_activity] || 1.0;

        //     // ì£¼ê´€ì  ê±´ê°• ì¸ì‹
        //     const healthPerceptionMultiplier = {
        //         'excellent': 0.8,
        //         'good': 0.9,
        //         'fair': 1.0,
        //         'poor': 1.3,
        //         'very_poor': 1.6
        //     };
        //     riskMultiplier *= healthPerceptionMultiplier[data.health_perception] || 1.0;

        //     // ìƒí™œìŠµê´€ ìš”ì¸ë“¤
        //     riskMultiplier *= getLifestyleRisk(data, 'hyperlipidemia');

        //     // ì§ˆë³‘ ê³¼ê±°ë ¥
        //     if (data.other_diseases.includes('thyroid')) {
        //         riskMultiplier *= 1.4;
        //     }
        //     if (data.other_diseases.includes('fatty_liver')) {
        //         riskMultiplier *= 1.6;
        //     }

        //     return Math.min(baseRisk * riskMultiplier, 90);
        // }
        function calculateHyperlipidemiaRisk(data) {
            // Based on lipid disorder risk assessment and cardiovascular risk calculators
            
            let riskPoints = 0;
            const age = parseInt(data.age);
            const gender = data.gender;
            
            // Age points (lipid disorders can start earlier, especially in men)
            if (age >= 20 && age < 30) riskPoints += 1;
            else if (age >= 30 && age < 40) riskPoints += 3;
            else if (age >= 40 && age < 50) riskPoints += 5;
            else if (age >= 50 && age < 60) riskPoints += 7;
            else if (age >= 60) riskPoints += 9;
            
            // Gender (men at higher risk, especially younger)
            if (gender === 'male') {
                if (age < 50) riskPoints += 2;
                else riskPoints += 1;
            }
            
            // BMI and body composition
            const bmi = getBMIValue(data);
            if (bmi >= 30) riskPoints += 3;
            else if (bmi >= 25) riskPoints += 2;
            
            // Waist circumference (linked to metabolic syndrome)
            if (data.waist && !document.getElementById('waist').disabled) {
                let waistCm = parseFloat(data.waist);
                if (data.waist_unit === 'inch') waistCm *= 2.54;
                
                const threshold = gender === 'male' ? 94 : 80; // Metabolic syndrome thresholds
                if (waistCm >= threshold + 10) riskPoints += 2;
                else if (waistCm >= threshold) riskPoints += 1;
            }
            
            // Family history (genetic component)
            if (data.family_history.includes('parent_hyperlipidemia')) riskPoints += 3;
            if (data.family_history.includes('grandparent_hyperlipidemia')) riskPoints += 1;
            if (data.family_history.includes('sibling_hyperlipidemia')) riskPoints += 2;
            
            // Diet and lifestyle (major factors for lipids)
            if (data.diet_habits.includes('fried_food')) riskPoints += 2;
            if (data.diet_habits.includes('processed_food')) riskPoints += 2;
            if (data.eating_out === '7+') riskPoints += 1;
            if (data.exercise_frequency === '0') riskPoints += 2;
            
            // Smoking (affects HDL and overall lipid profile)
            if (data.smoking === 'current') {
                const amount = parseFloat(data.smoking_amount) || 10;
                if (amount > 20) riskPoints += 2;
                else riskPoints += 1;
            }
            
            // Medical conditions
            if (data.other_diseases.includes('thyroid')) riskPoints += 2;
            if (data.other_diseases.includes('fatty_liver')) riskPoints += 2;
            if (data.past_chronic_diseases.includes('diabetes')) riskPoints += 3;
            if (data.past_chronic_diseases.includes('hypertension')) riskPoints += 2;
            
            // Occupation and activity level
            if (data.occupation_activity === 'sedentary') riskPoints += 1;
            
            // Stress (affects cortisol and lipid metabolism)
            if (data.stress_level === 'high') riskPoints += 1;
            
            // Alcohol (moderate consumption can be protective, excessive harmful)
            if (data.drinking === 'frequent') {
                const amount = parseFloat(data.drinking_amount) || 3;
                if (amount > 4) riskPoints += 1; // Excessive drinking
            }
            
            // Convert points to percentage using validated lipid disorder incidence rates
            let riskPercentage = 0;
            
            if (riskPoints <= 5) riskPercentage = Math.min(riskPoints * 3, 15); // 0-15%
            else if (riskPoints <= 10) riskPercentage = 15 + (riskPoints - 5) * 4; // 15-35%
            else if (riskPoints <= 15) riskPercentage = 35 + (riskPoints - 10) * 5; // 35-60%
            else riskPercentage = Math.min(60 + (riskPoints - 15) * 3, 80); // 60-80% max
            
            return Math.min(riskPercentage, 80); // Cap at 80% based on population studies
        }

        // ë³´ì¡° í•¨ìˆ˜ë“¤
        // function getBaseRiskByAge(age, disease) {
        //     // ì—°ì†ì ì¸ ë‚˜ì´ë¥¼ ì‚¬ìš©í•œ ì„ í˜• ê³„ì‚°
        //     const riskTable = {
        //         'hypertension': { base: 2, increment: 1.8 },
        //         'diabetes': { base: 1, increment: 1.2 },
        //         'hyperlipidemia': { base: 3, increment: 2.0 }
        //     };

        //     const config = riskTable[disease];
        //     const ageAdjusted = Math.max(0, age - 20); // 20ì„¸ ê¸°ì¤€
        //     return config.base + (ageAdjusted * config.increment);
        // }

        function getBaseRiskByAge(age, disease) {
            // Evidence-based baseline risks per decade
            const riskTable = {
                'hypertension': {
                    20: 5, 30: 8, 40: 12, 50: 18, 60: 25, 70: 35
                },
                'diabetes': {
                    20: 2, 30: 3, 40: 5, 50: 8, 60: 12, 70: 18
                },
                'hyperlipidemia': {
                    20: 8, 30: 12, 40: 18, 50: 25, 60: 35, 70: 45
                }
            };
            
            const ageGroup = Math.floor(age / 10) * 10;
            const clampedAge = Math.max(20, Math.min(70, ageGroup));
            
            return riskTable[disease][clampedAge] || riskTable[disease][70];
        }

        function getBMIRiskMultiplier(data) {
            if (!data.height || !data.weight) return 1.0;
            
            const bmi = parseFloat(data.weight) / ((parseFloat(data.height) / 100) ** 2);
            if (bmi < 18.5) return 1.1; // ì €ì²´ì¤‘ë„ ìœ„í—˜
            if (bmi < 23) return 1.0; // ì •ìƒ
            if (bmi < 25) return 1.4; // ê³¼ì²´ì¤‘
            if (bmi < 30) return 1.8; // ë¹„ë§Œ
            return 2.5; // ê³ ë„ë¹„ë§Œ
        }

        function getWaistRiskMultiplier(data) {
            if (!data.waist || document.getElementById('waist').disabled) return 1.0;
            
            let waistCm = parseFloat(data.waist);
            
            // ì¸ì¹˜ë¥¼ cmë¡œ ë³€í™˜
            if (data.waist_unit === 'inch') {
                waistCm = waistCm * 2.54;
            }
            
            const threshold = data.gender === 'male' ? 90 : 85;
            
            if (waistCm >= threshold + 10) return 2.0;
            if (waistCm >= threshold) return 1.6;
            return 1.0;
        }

        function getFamilyHistoryRisk(familyHistory, disease) {
            let multiplier = 1.0;
            
            // ë¶€ëª¨
            if (familyHistory.includes(`parent_${disease}`)) {
                multiplier *= 2.2;
            }
            
            // ì¡°ë¶€ëª¨
            if (familyHistory.includes(`grandparent_${disease}`)) {
                multiplier *= 1.6;
            }
            
            // í˜•ì œìë§¤ (ìƒˆë¡œ ì¶”ê°€)
            if (familyHistory.includes(`sibling_${disease}`)) {
                multiplier *= 1.8;
            }
            
            return multiplier;
        }

        function getSleepStressRisk(data) {
            let multiplier = 1.0;
            
            // ìˆ˜ë©´ ë¬¸ì œ
            let sleepIssues = 0;
            if (data.sleep_hours === '<6' || data.sleep_hours === '>8') sleepIssues++;
            if (data.sleep_quality === 'unsatisfied') sleepIssues++;
            if (data.sleep_interruption === 'often') sleepIssues++;
            if (data.sleep_regularity === 'irregular') sleepIssues++;
            
            // ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€
            const stressHigh = data.stress_level === 'high';
            const stressLong = data.stress_duration === '1month+';
            
            // êµì°¨ íš¨ê³¼: ìˆ˜ë©´ ë¬¸ì œì™€ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë™ì‹œì— ìˆì„ ë•Œ ì‹œë„ˆì§€
            if (sleepIssues >= 2 && stressHigh) {
                multiplier *= 1.6; // ì‹œë„ˆì§€ íš¨ê³¼
            } else {
                if (sleepIssues >= 2) multiplier *= 1.3;
                if (stressHigh) multiplier *= 1.4;
            }
            
            if (stressLong) multiplier *= 1.2;
            
            return multiplier;
        }

        function getLifestyleRisk(data, disease) {
            let multiplier = 1.0;
            
            // ìš´ë™
            if (data.exercise_frequency === '0') {
                multiplier *= disease === 'diabetes' ? 1.6 : 1.4;
            }
            
            // ì‹ì´ìŠµê´€
            if (disease === 'hypertension' && data.diet_habits.includes('high_sodium')) {
                multiplier *= 1.6;
            }
            if (disease === 'diabetes' && data.diet_habits.includes('high_sugar')) {
                multiplier *= 1.4;
            }
            if (data.diet_habits.includes('processed_food')) {
                multiplier *= 1.3;
            }
            
            // í¡ì—°
            if (data.smoking === 'current') {
                const amount = parseFloat(data.smoking_amount) || 10;
                multiplier *= disease === 'hypertension' ? 1.8 : 1.4;
                if (amount > 20) multiplier *= 1.2;
            }
            
            // ìŒì£¼
            if (data.drinking === 'frequent') {
                const amount = parseFloat(data.drinking_amount) || 3;
                multiplier *= 1.3;
                if (amount > 5) multiplier *= 1.2;
            }
            
            return multiplier;
        }

        // 5. ê²°ê³¼ í‘œì‹œ (ê°œì„ ëœ ë²„ì „)
        function displayResults(risks, data) {
            console.log('ğŸ” displayResults ë””ë²„ê¹…:');
            console.log('ì „ë‹¬ë°›ì€ risks:', risks);
            console.log('ê³ ì§€í˜ˆì¦ ì¡´ì¬ ì—¬ë¶€:', 'hyperlipidemia' in risks);
            console.log('ê³ ì§€í˜ˆì¦ ê°’:', risks.hyperlipidemia);
            
            const results = document.getElementById('results');
            const age = parseInt(data.age);
            const gender = data.gender;
            
            // í‰ê·  ìœ„í—˜ë„ ê°€ì ¸ì˜¤ê¸°
            const averageRisks = getAverageRiskByDemographic(age, gender);
            
            // ì„±ë³„ê³¼ ì—°ë ¹ëŒ€ í…ìŠ¤íŠ¸ ë³€í™˜
            const genderText = gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
            
            // ê°œì¸ ìœ„í—˜ë„ ì°¨íŠ¸
            const personalChart = createBarChart(
                risks, 
                'ğŸ¯ ê°œì¸ ë§ì¶¤ ìœ„í—˜ë„ ê²°ê³¼', 
                `${age}ì„¸ ${genderText}ì¸ ê·€í•˜ì˜ ì˜ˆì¸¡ ê²°ê³¼ì…ë‹ˆë‹¤`,
                'personalChart'
            );
            
            // í‰ê·  ìœ„í—˜ë„ ì°¨íŠ¸
            const averageChart = createBarChart(
                averageRisks,
                'ğŸ“Š ë™ì¼ ì—°ë ¹ëŒ€/ì„±ë³„ í‰ê·  ìœ„í—˜ë„',
                `${age}ì„¸ ${genderText} ì¼ë°˜ ì¸êµ¬ì˜ í‰ê· ì ì¸ ìœ„í—˜ë„ì…ë‹ˆë‹¤`,
                'averageChart'
            );

            // ìœ„í—˜ë„ ì¹´ë“œ
            const riskCards = createRiskCards(risks);
            
            // ë¹„êµ ë¶„ì„
            const comparisonAnalysis = createComparisonAnalysis(risks, averageRisks);
            
            // ê²°ê³¼ HTML êµ¬ì„± (PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì œì™¸)
            results.innerHTML = `
                <h3>ğŸ” ìœ„í—˜ë„ ì˜ˆì¸¡ ê²°ê³¼</h3>
                
                ${riskCards}
                
                ${personalChart}
                
                ${averageChart}
                
                ${comparisonAnalysis}
                
                <div class="recommendations" id="recommendations">
                    <!-- ê¶Œì¥ì‚¬í•­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            `;

            // DOM ì‚½ì… í›„ í™•ì¸
            setTimeout(() => {
                const allRiskCards = document.querySelectorAll('.risk-card');
                const hyperlipidemiaCard = document.querySelector('.risk-card[data-disease="hyperlipidemia"]');
                
                console.log('ğŸ” DOM ì‚½ì… í›„ í™•ì¸:');
                console.log('ì „ì²´ ìœ„í—˜ë„ ì¹´ë“œ ê°œìˆ˜:', allRiskCards.length);
                console.log('ê³ ì§€í˜ˆì¦ ì¹´ë“œ ì¡´ì¬:', !!hyperlipidemiaCard);
                console.log('ê³ ì§€í˜ˆì¦ ì¹´ë“œ ìš”ì†Œ:', hyperlipidemiaCard);
                
                if (hyperlipidemiaCard) {
                    const computedStyle = window.getComputedStyle(hyperlipidemiaCard);
                    console.log('ê³ ì§€í˜ˆì¦ ì¹´ë“œ ìŠ¤íƒ€ì¼:', {
                        display: computedStyle.display,
                        visibility: computedStyle.visibility,
                        opacity: computedStyle.opacity,
                        overflow: computedStyle.overflow,
                        position: computedStyle.position,
                        zIndex: computedStyle.zIndex
                    });
                }
            }, 200);

            // ê¶Œì¥ì‚¬í•­ ìƒì„±
            generateDetailedRecommendations(risks, data);

            // ê²°ê³¼ ì„¹ì…˜ê³¼ PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('results').style.display = 'block';
            document.getElementById('downloadButtonContainer').style.display = 'block';
            
            // ì°¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ (ì•½ê°„ì˜ ì§€ì—° í›„)
            setTimeout(() => {
                animateCharts();
            }, 100);
            
            // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            
            // ì¶”ê°€: bar-fill ì§ì ‘ ì„¤ì •
            document.querySelectorAll('.bar-fill').forEach(bar => {
                const targetWidth = bar.getAttribute('data-width');
                bar.style.width = '0';        // ì´ˆê¸°í™”
                void bar.offsetWidth;         // ê°•ì œ reflow
                bar.style.width = targetWidth; // ë‹¤ì‹œ ì ìš©
            });
        }

        function createRiskCards(risks) {
            const diseases = [
                { key: 'hypertension', name: 'ê³ í˜ˆì••', icon: 'â¤ï¸' },
                { key: 'diabetes', name: 'ë‹¹ë‡¨ë³‘', icon: 'ğŸ©¸' },
                { key: 'hyperlipidemia', name: 'ê³ ì§€í˜ˆì¦', icon: 'ğŸ§ª' }
            ];

            console.log('ğŸ” createRiskCards ë””ë²„ê¹…:');
            console.log('ì „ì²´ risks ê°ì²´:', risks);
            console.log('ê³ ì§€í˜ˆì¦ ê°’:', risks.hyperlipidemia);
            console.log('ê³ ì§€í˜ˆì¦ íƒ€ì…:', typeof risks.hyperlipidemia);

            let cardsHtml = '<div class="risk-cards">';
            
            diseases.forEach((disease, index) => {
                const risk = Math.round(risks[disease.key]);
                const riskLevel = getRiskLevel(risk);
                
                console.log(`${disease.name} ì¹´ë“œ ìƒì„±:`, {
                    key: disease.key,
                    rawRisk: risks[disease.key],
                    roundedRisk: risk,
                    riskLevel: riskLevel
                });
                
                cardsHtml += `
                    <div class="risk-card ${riskLevel.class}" data-disease="${disease.key}">
                        <div class="risk-icon">${disease.icon}</div>
                        <h4>${disease.name}</h4>
                        <div class="risk-percentage">${risk}%</div>
                        <div class="risk-level">${riskLevel.text}</div>
                    </div>
                `;
            });
            
            cardsHtml += '</div>';
            console.log('ìƒì„±ëœ ì¹´ë“œ HTML:', cardsHtml);
            return cardsHtml;
        }

        function getRiskLevel(percentage) {
            if (percentage < 20) {
                return { level: 'low', class: 'low-risk', text: 'ë‚®ì€ ìœ„í—˜' };
            } else if (percentage < 40) {
                return { level: 'moderate', class: 'moderate-risk', text: 'ë³´í†µ ìœ„í—˜' };
            } else {
                return { level: 'high', class: 'high-risk', text: 'ë†’ì€ ìœ„í—˜' };
            }
        }

        // function getAverageRiskByDemographic(age, gender) {
        //     // ì—°ì†ì ì¸ ë‚˜ì´ë¥¼ ì‚¬ìš©í•œ í‰ê·  ìœ„í—˜ë„ ê³„ì‚°
        //     const baseMultiplier = gender === 'male' ? 1.2 : 1.0;
            
        //     return {
        //         hypertension: Math.min((age - 20) * 1.5 * baseMultiplier + 5, 75),
        //         diabetes: Math.min((age - 20) * 1.0 * baseMultiplier + 3, 60),
        //         hyperlipidemia: Math.min((age - 20) * 1.8 * baseMultiplier + 8, 70)
        //     };
        // }
        function getAverageRiskByDemographic(age, gender) {
            // Evidence-based population averages from epidemiological studies
            const baseMultiplier = gender === 'male' ? 1.0 : 0.85; // Men slightly higher risk overall
            
            // Age-stratified baseline risks based on population studies
            let hypertensionBase, diabetesBase, hyperlipidemiaBase;
            
            if (age < 30) {
                hypertensionBase = 3;
                diabetesBase = 1;
                hyperlipidemiaBase = 8;
            } else if (age < 40) {
                hypertensionBase = 6;
                diabetesBase = 2;
                hyperlipidemiaBase = 15;
            } else if (age < 50) {
                hypertensionBase = 12;
                diabetesBase = 4;
                hyperlipidemiaBase = 25;
            } else if (age < 60) {
                hypertensionBase = 20;
                diabetesBase = 8;
                hyperlipidemiaBase = 35;
            } else {
                hypertensionBase = 30;
                diabetesBase = 12;
                hyperlipidemiaBase = 45;
            }
            
            return {
                hypertension: Math.min(hypertensionBase * baseMultiplier, 50),
                diabetes: Math.min(diabetesBase * baseMultiplier, 35),
                hyperlipidemia: Math.min(hyperlipidemiaBase * baseMultiplier, 60)
            };
        }

        function createBarChart(risks, title, subtitle, containerId) {
            const diseases = [
                { key: 'hypertension', name: 'ê³ í˜ˆì••', color: 'hypertension' },
                { key: 'diabetes', name: 'ë‹¹ë‡¨ë³‘', color: 'diabetes' },
                { key: 'hyperlipidemia', name: 'ê³ ì§€í˜ˆì¦', color: 'hyperlipidemia' }
            ];

            console.log('ì°¨íŠ¸ ìƒì„± ì‹œì‘:', title);
            console.log('ìœ„í—˜ë„ ë°ì´í„°:', risks);

            let chartHtml = `
                <div class="chart-container">
                    <div class="chart-title">${title}</div>
                    <div class="chart-subtitle">${subtitle}</div>
                    <div class="chart-canvas-container">
                        <div class="bar-chart">
            `;

            diseases.forEach((disease, index) => {
                const risk = Math.round(risks[disease.key]);
                console.log(`${disease.name} ìœ„í—˜ë„: ${risk}%`);
                
                chartHtml += `
                    <div class="bar-item" data-disease="${disease.key}">
                        <div class="bar-label">${disease.name}</div>
                        <div class="bar-container">
                            <div class="bar-fill ${disease.color}" 
                                 style="width: ${risk}%;" 
                                 data-width="${risk}%" 
                                 data-disease="${disease.key}"></div>
                        </div>
                        <div class="bar-percentage">${risk}%</div>
                    </div>
                `;
            });

            chartHtml += `
                        </div>
                    </div>
                </div>
            `;

            console.log('ì°¨íŠ¸ HTML ìƒì„± ì™„ë£Œ');
            return chartHtml;
        }

        // Chart.jsë¥¼ ì‚¬ìš©í•  ê²½ìš°ì˜ ì„¤ì • í•¨ìˆ˜ (í–¥í›„ ì‚¬ìš©ì„ ìœ„í•œ ì¤€ë¹„)
        function createChartJSChart(canvasId, data, options = {}) {
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: options.title || 'ì°¨íŠ¸'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            };

            // Chart.js ì˜µì…˜ ë³‘í•©
            const chartOptions = { ...defaultOptions, ...options };

            // Chart.jsê°€ ë¡œë“œë˜ì–´ ìˆë‹¤ë©´ ì°¨íŠ¸ ìƒì„±
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById(canvasId).getContext('2d');
                return new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: chartOptions
                });
            } else {
                console.warn('Chart.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return null;
            }
        }

        function createComparisonAnalysis(personalRisks, averageRisks) {
            const personalAvg = (personalRisks.hypertension + personalRisks.diabetes + personalRisks.hyperlipidemia) / 3;
            const populationAvg = (averageRisks.hypertension + averageRisks.diabetes + averageRisks.hyperlipidemia) / 3;
            
            let analysisText = '';
            let analysisClass = '';
            
            if (personalAvg < populationAvg * 0.8) {
                analysisText = 'ğŸ‰ ì „ë°˜ì ìœ¼ë¡œ ë™ì¼ ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ ë‚®ì€ ìœ„í—˜ë„ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ì˜ ê±´ê°•í•œ ìƒí™œìŠµê´€ì„ ê³„ì† ìœ ì§€í•˜ì„¸ìš”!';
                analysisClass = 'low-risk';
            } else if (personalAvg > populationAvg * 1.3) {
                analysisText = 'âš ï¸ ë™ì¼ ì—°ë ¹ëŒ€ í‰ê· ë³´ë‹¤ ë†’ì€ ìœ„í—˜ë„ë¥¼ ë³´ì´ê³  ìˆì–´ ì ê·¹ì ì¸ ìƒí™œìŠµê´€ ê°œì„ ê³¼ ì •ê¸°ì ì¸ ê±´ê°•ê²€ì§„ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                analysisClass = 'high-risk';
            } else {
                analysisText = 'ğŸ“Š ë™ì¼ ì—°ë ¹ëŒ€ í‰ê· ê³¼ ë¹„ìŠ·í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ê¾¸ì¤€í•œ ê±´ê°•ê´€ë¦¬ë¡œ ìœ„í—˜ë„ë¥¼ ë” ë‚®ì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                analysisClass = 'moderate-risk';
            }

            return `
                <div class="comparison-note ${analysisClass}">
                    <strong>ğŸ“‹ ì¢…í•© ë¶„ì„:</strong> ${analysisText}
                </div>
            `;
        }

        function animateCharts() {
            // DOM ì‚½ì… í›„ ê°•ì œ Reflow íŠ¸ë¦¬ê±°
            const resultsContainer = document.getElementById('results');
            resultsContainer.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
            
            // ì°¨íŠ¸ ìƒì„± í›„ ì ì‹œ ëŒ€ê¸°
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.bar-fill');
                console.log('ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰ - Progress Bar ê°œìˆ˜:', progressBars.length);
                console.log('Progress Bar ìš”ì†Œë“¤:', progressBars);
                
                // ê° ë°”ì˜ í´ë˜ìŠ¤ì™€ ë°ì´í„° í™•ì¸
                progressBars.forEach((bar, index) => {
                    console.log(`Bar ${index + 1}:`, {
                        classes: bar.className,
                        dataWidth: bar.getAttribute('data-width'),
                        currentWidth: bar.style.width
                    });
                });
                
                // ë¨¼ì € ëª¨ë“  ë°”ì˜ ì´ˆê¸° ìƒíƒœ ì„¤ì •
                progressBars.forEach((bar, index) => {
                    const targetWidth = bar.getAttribute('data-width');
                    console.log(`Progress Bar ${index + 1}: ${targetWidth}`);
                    
                    if (targetWidth) {
                        // ì´ˆê¸° ìƒíƒœ ê°•ì œ ì„¤ì •
                        bar.style.display = 'block';
                        bar.style.visibility = 'visible';
                        bar.style.opacity = '1';
                        bar.style.height = '100%';
                        bar.style.width = '0'; // ì´ˆê¸°ì—ëŠ” 0ìœ¼ë¡œ ì„¤ì •
                        
                        // ìƒ‰ìƒ ê°•ì œ ì ìš©
                        if (bar.classList.contains('hypertension')) {
                            bar.style.background = 'linear-gradient(90deg, #ff6b6b, #ff5252)';
                            console.log('ê³ í˜ˆì•• ìƒ‰ìƒ ì ìš©');
                        } else if (bar.classList.contains('diabetes')) {
                            bar.style.background = 'linear-gradient(90deg, #4ecdc4, #26a69a)';
                            console.log('ë‹¹ë‡¨ë³‘ ìƒ‰ìƒ ì ìš©');
                        } else if (bar.classList.contains('hyperlipidemia')) {
                            bar.style.background = 'linear-gradient(90deg, #45b7d1, #2196f3)';
                            console.log('ê³ ì§€í˜ˆì¦ ìƒ‰ìƒ ì ìš©');
                        }
                    }
                });
                
                // ê°•ì œ Reflow íŠ¸ë¦¬ê±° (ìš”ì²­í•˜ì‹  ë°©ì‹)
                progressBars.forEach((bar, index) => {
                    const width = bar.getAttribute('data-width');
                    if (width) {
                        bar.style.width = '0';
                        void bar.offsetWidth; // ê°•ì œ ë¦¬í”Œë¡œìš°
                        // ì•½ê°„ì˜ ì§€ì—° í›„ ì‹¤ì œ ë„ˆë¹„ ì ìš©
                        setTimeout(() => {
                            bar.style.width = width;
                            console.log(`Bar ${index + 1} ì¦‰ì‹œ ì ìš©: ${width}`);
                        }, 50 + (index * 10));
                    }
                });
                
                // ì¶”ê°€ ë³´ì¥: ê° ë°”ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜
                progressBars.forEach((bar, index) => {
                    const targetWidth = bar.getAttribute('data-width');
                    if (targetWidth) {
                        setTimeout(() => {
                            bar.style.width = targetWidth;
                            console.log(`Bar ${index + 1} ì• ë‹ˆë©”ì´ì…˜ ì ìš©: ${targetWidth}`);
                        }, 300 + (index * 200));
                    }
                });
                
                // ìµœì¢… ë³´ì¥: 2ì´ˆ í›„ ëª¨ë“  ë°” ë‹¤ì‹œ í™•ì¸
                setTimeout(() => {
                    const finalCheck = document.querySelectorAll('.bar-fill');
                    console.log('ìµœì¢… í™•ì¸ - ì´ ë°” ê°œìˆ˜:', finalCheck.length);
                    
                    finalCheck.forEach((bar, index) => {
                        const targetWidth = bar.getAttribute('data-width');
                        const currentWidth = bar.style.width;
                        console.log(`ìµœì¢… í™•ì¸ Bar ${index + 1}:`, {
                            target: targetWidth,
                            current: currentWidth,
                            classes: bar.className
                        });
                        
                        if (targetWidth && (currentWidth === '0px' || currentWidth === '0%' || currentWidth === '')) {
                            bar.style.width = targetWidth;
                            console.log(`ìµœì¢… í™•ì¸ - Bar ${index + 1} ì¬ì ìš©: ${targetWidth}`);
                        }
                    });
                }, 2500);
                
            }, 100); // ì°¨íŠ¸ ìƒì„± í›„ 100ms ëŒ€ê¸°
        }

        // 6. ìƒì„¸ ê¶Œì¥ì‚¬í•­ ìƒì„±
        function generateDetailedRecommendations(risks, data) {
            const diseases = [
                { key: 'hypertension', name: 'ê³ í˜ˆì••', icon: 'â¤ï¸' },
                { key: 'diabetes', name: 'ë‹¹ë‡¨ë³‘', icon: 'ğŸ©¸' },
                { key: 'hyperlipidemia', name: 'ê³ ì§€í˜ˆì¦', icon: 'ğŸ§ª' }
            ];

            let recommendationsHtml = '<h4>ğŸ“‹ ì§ˆí™˜ë³„ ë§ì¶¤ ì˜ˆë°© ê¶Œì¥ì‚¬í•­</h4>';

            diseases.forEach(disease => {
                const risk = Math.round(risks[disease.key]);
                const riskLevel = getRiskLevel(risk);
                const recommendations = getSpecificRecommendations(disease.key, risk, data);

                recommendationsHtml += `
                    <div class="disease-recommendations">
                        <h5>${disease.icon} ${disease.name} (ìœ„í—˜ë„: ${risk}%)</h5>
                        <ul>
                `;

                recommendations.forEach(rec => {
                    recommendationsHtml += `
                        <li>
                            â€¢ ${rec.text}
                            ${rec.detail ? `<a href="#" class="detail-link" onclick="showDetail('${rec.detail}')">ìì„¸íˆ ë³´ê¸°</a>` : ''}
                        </li>
                    `;
                });

                recommendationsHtml += '</ul></div>';
            });

            document.getElementById('recommendations').innerHTML = recommendationsHtml;
        }

        function getSpecificRecommendations(disease, risk, data) {
            const recommendations = [];
            
            if (disease === 'hypertension') {
                if (risk > 40) {
                    recommendations.push({
                        text: 'ì •ê¸°ì ì¸ í˜ˆì•• ì¸¡ì •ê³¼ ì „ë¬¸ì˜ ìƒë‹´ì„ ë°›ìœ¼ì„¸ìš”',
                        detail: 'hypertension_monitoring'
                    });
                }
                
                if (data.diet_habits.includes('high_sodium')) {
                    recommendations.push({
                        text: 'ë‚˜íŠ¸ë¥¨ ì„­ì·¨ë¥¼ í•˜ë£¨ 2000mg ì´í•˜ë¡œ ì œí•œí•˜ì„¸ìš”',
                        detail: 'sodium_reduction'
                    });
                }
                
                if (data.exercise_frequency === '0') {
                    recommendations.push({
                        text: 'ì£¼ 3-4íšŒ, 30ë¶„ ì´ìƒì˜ ìœ ì‚°ì†Œ ìš´ë™ì„ ì‹œì‘í•˜ì„¸ìš”',
                        detail: 'exercise_guide'
                    });
                }
            }
            
            if (disease === 'diabetes') {
                if (risk > 40) {
                    recommendations.push({
                        text: 'ê³µë³µí˜ˆë‹¹ ë° ë‹¹í™”í˜ˆìƒ‰ì†Œ ê²€ì‚¬ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ë°›ìœ¼ì„¸ìš”',
                        detail: 'diabetes_screening'
                    });
                }
                
                if (data.snack_types.includes('candy') || data.snack_types.includes('chocolate')) {
                    recommendations.push({
                        text: 'ë‹¨ìˆœë‹¹ ì„­ì·¨ë¥¼ ì¤„ì´ê³  ë³µí•©íƒ„ìˆ˜í™”ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”',
                        detail: 'sugar_management'
                    });
                }
            }
            
            if (disease === 'hyperlipidemia') {
                if (risk > 40) {
                    recommendations.push({
                        text: 'í˜ˆì¤‘ ì½œë ˆìŠ¤í…Œë¡¤ ìˆ˜ì¹˜ë¥¼ ì •ê¸°ì ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”',
                        detail: 'cholesterol_monitoring'
                    });
                }
                
                if (data.diet_habits.includes('processed_food')) {
                    recommendations.push({
                        text: 'í¬í™”ì§€ë°©ê³¼ íŠ¸ëœìŠ¤ì§€ë°© ì„­ì·¨ë¥¼ ì œí•œí•˜ì„¸ìš”',
                        detail: 'fat_management'
                    });
                }
            }
            
            return recommendations;
        }

        function showDetail(detailType) {
            const details = {
                'hypertension_monitoring': 'í˜ˆì••ì€ ì•„ì¹¨ ê¸°ìƒ í›„ì™€ ì €ë… ì ìë¦¬ì— ë“¤ê¸° ì „ ì¸¡ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì—°ì† 3ì¼ ì¸¡ì •í•œ í‰ê· ê°’ì„ ê¸°ë¡í•˜ì—¬ ì˜ì‚¬ì™€ ìƒë‹´í•˜ì„¸ìš”.',
                'sodium_reduction': 'ê¹€ì¹˜, ì “ê°ˆë¥˜, ë¼ë©´ ë“± ê³ ë‚˜íŠ¸ë¥¨ ì‹í’ˆì„ í”¼í•˜ê³ , ì²œì—° í–¥ì‹ ë£Œë‚˜ í—ˆë¸Œë¥¼ í™œìš©í•œ ì¡°ë¦¬ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”.',
                'exercise_guide': 'ë¹ ë¥¸ ê±·ê¸°, ìì „ê±° íƒ€ê¸°, ìˆ˜ì˜ ë“±ì˜ ìœ ì‚°ì†Œ ìš´ë™ì´ í˜ˆì•• ì¡°ì ˆì— íš¨ê³¼ì ì…ë‹ˆë‹¤. ìš´ë™ ê°•ë„ëŠ” ëŒ€í™”ê°€ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì—ì„œ ì‹œì‘í•˜ì„¸ìš”.',
                'diabetes_screening': 'ê³µë³µí˜ˆë‹¹ 100mg/dL ì´ìƒ, ë‹¹í™”í˜ˆìƒ‰ì†Œ 5.7% ì´ìƒì´ë©´ ë‹¹ë‡¨ ì „ë‹¨ê³„ë¡œ ë”ìš± ì£¼ì˜ ê¹Šì€ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
                'sugar_management': 'í˜„ë¯¸, í†µê³¡ë¬¼, ì±„ì†Œ ë“± ì„¬ìœ ì§ˆì´ í’ë¶€í•œ ì‹í’ˆì„ ì„ íƒí•˜ê³ , ê³¼ì¼ë„ í•˜ë£¨ 1-2íšŒ ì ë‹¹ëŸ‰ë§Œ ì„­ì·¨í•˜ì„¸ìš”.',
                'cholesterol_monitoring': 'ì´ ì½œë ˆìŠ¤í…Œë¡¤ 200mg/dL ì´í•˜, LDL ì½œë ˆìŠ¤í…Œë¡¤ 130mg/dL ì´í•˜ ìœ ì§€ë¥¼ ëª©í‘œë¡œ í•˜ì„¸ìš”.',
                'fat_management': 'ì˜¬ë¦¬ë¸Œì˜¤ì¼, ê²¬ê³¼ë¥˜ ë“±ì˜ ë¶ˆí¬í™”ì§€ë°©ì„ ì„ íƒí•˜ê³ , íŠ€ê¹€ìŒì‹ê³¼ ê°€ê³µìœ¡ ì„­ì·¨ë¥¼ ì¤„ì´ì„¸ìš”.'
            };
            
            alert(details[detailType] || 'ìƒì„¸ ì •ë³´ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // 7. PDF ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (html2canvas + jsPDF ë°©ì‹)
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            
            // ê²°ê³¼ ì˜ì—­ ê°€ì ¸ì˜¤ê¸°
            const resultsElement = document.getElementById('results');
            
            if (!resultsElement) {
                alert('ê²°ê³¼ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© ìƒíƒœ í‘œì‹œ (ì„ íƒì‚¬í•­)
            const downloadBtn = document.querySelector('#downloadButtonContainer button');
            const originalText = downloadBtn.textContent;
            downloadBtn.textContent = 'ğŸ“„ PDF ìƒì„± ì¤‘...';
            downloadBtn.disabled = true;

            // html2canvasë¡œ ê²°ê³¼ ì˜ì—­ ìº¡ì²˜
            html2canvas(resultsElement, {
                scale: 1,           // ë©”ëª¨ë¦¬ ì ˆì•½ì„ ìœ„í•´ 1ë¡œ ì„¤ì •
                useCORS: true,      // CORS í—ˆìš©
                allowTaint: true,
                backgroundColor: '#ffffff',
                logging: false,     // ì½˜ì†” ë¡œê·¸ ë¹„í™œì„±í™”
                width: resultsElement.scrollWidth,
                height: resultsElement.scrollHeight
            }).then(function(canvas) {
                try {
                    // A4 í¬ê¸° ì„¤ì • (210 x 297 mm)
                    const doc = new jsPDF('p', 'mm', 'a4');
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    
                    // ë§ˆì§„ ì„¤ì • (10mm)
                    const margin = 10;
                    const maxWidth = pageWidth - (margin * 2);
                    const maxHeight = pageHeight - (margin * 2);
                    
                    // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
                    const imgData = canvas.toDataURL('image/png');
                    
                    // ì›ë³¸ ì´ë¯¸ì§€ í¬ê¸°
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    
                    // ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ í˜ì´ì§€ì— ë§ê²Œ í¬ê¸° ì¡°ì ˆ
                    const ratio = Math.min(maxWidth / (imgWidth * 0.264583), maxHeight / (imgHeight * 0.264583));
                    const scaledWidth = imgWidth * 0.264583 * ratio;  // px to mm ë³€í™˜ (1px = 0.264583mm)
                    const scaledHeight = imgHeight * 0.264583 * ratio;
                    
                    // ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ x, y ì¢Œí‘œ ê³„ì‚°
                    const x = (pageWidth - scaledWidth) / 2;
                    const y = margin;
                    
                    // ì´ë¯¸ì§€ê°€ í•œ í˜ì´ì§€ë¥¼ ë„˜ëŠ” ê²½ìš° í˜ì´ì§€ ë¶„í•  ì²˜ë¦¬
                    if (scaledHeight > maxHeight) {
                        // ì—¬ëŸ¬ í˜ì´ì§€ë¡œ ë¶„í• 
                        let remainingHeight = scaledHeight;
                        let sourceY = 0;
                        let pageCount = 0;
                        
                        while (remainingHeight > 0) {
                            if (pageCount > 0) {
                                doc.addPage();
                            }
                            
                            const currentPageHeight = Math.min(maxHeight, remainingHeight);
                            const sourceHeight = (currentPageHeight / scaledHeight) * imgHeight;
                            
                            // í˜„ì¬ í˜ì´ì§€ìš© ìº”ë²„ìŠ¤ ìƒì„±
                            const tempCanvas = document.createElement('canvas');
                            tempCanvas.width = imgWidth;
                            tempCanvas.height = sourceHeight;
                            const tempCtx = tempCanvas.getContext('2d');
                            
                            // ì›ë³¸ ìº”ë²„ìŠ¤ì—ì„œ í•´ë‹¹ ë¶€ë¶„ ë³µì‚¬
                            tempCtx.drawImage(canvas, 0, sourceY, imgWidth, sourceHeight, 0, 0, imgWidth, sourceHeight);
                            
                            const tempImgData = tempCanvas.toDataURL('image/png');
                            doc.addImage(tempImgData, 'PNG', x, y, scaledWidth, currentPageHeight);
                            
                            remainingHeight -= currentPageHeight;
                            sourceY += sourceHeight;
                            pageCount++;
                        }
                    } else {
                        // í•œ í˜ì´ì§€ì— ë“¤ì–´ê°€ëŠ” ê²½ìš°
                        doc.addImage(imgData, 'PNG', x, y, scaledWidth, scaledHeight);
                    }
                    
                    // PDF ì €ì¥
                    doc.save('ë§Œì„±ì§ˆí™˜_ìœ„í—˜ë„_ì˜ˆì¸¡_ê²°ê³¼.pdf');
                    
                } catch (error) {
                    console.error('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
                } finally {
                    // ë²„íŠ¼ ìƒíƒœ ë³µì›
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;
                }
            }).catch(function(error) {
                console.error('ìº”ë²„ìŠ¤ ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('í™”ë©´ ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
                
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
            });
        }

        // 8. ì„œë²„ë¡œ ìœ„í—˜ë„ ë°ì´í„° ì „ì†¡
        function sendRiskToServer(userData) {
            console.log("ì „ì†¡í•  ë°ì´í„°:", userData);
            
            // ë°ì´í„° ê²€ì¦
            if (!userData.name || !userData.age || !userData.gender) {
                console.error("í•„ìˆ˜ ë°ì´í„°ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤:", userData);
                alert("í•„ìˆ˜ ì •ë³´ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ë¦„, ë‚˜ì´, ì„±ë³„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return;
            }
            fetch("https://gys1231.app.n8n.cloud/webhook/store-risk", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify({
                    name: userData.name,
                    age: userData.age,
                    gender: userData.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±',
                    bmi: userData.bmi || 0,
                    hypertension: userData.hypertension || 0,
                    diabetes: userData.diabetes || 0,
                    dyslipidemia: userData.dyslipidemia || 0,
                    date: new Date().toLocaleString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    })
                })
            })
            .then(response => {
                console.log("HTTP ì‘ë‹µ ìƒíƒœ:", response.status, response.statusText);
                
                // ì‘ë‹µì´ JSONì´ ì•„ë‹ ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ì½ê¸°
                return response.text().then(text => {
                    console.log("ì‘ë‹µ í…ìŠ¤íŠ¸:", text);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    // JSON íŒŒì‹± ì‹œë„
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.log("JSON íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ ì‘ë‹µ:", text);
                        return { message: text };
                    }
                });
            })
            .then(data => {
                console.log("ì„œë²„ ì‘ë‹µ ì„±ê³µ:", data);
                alert("ìœ„í—˜ë„ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            })
            .catch(error => {
                console.error("ë°ì´í„° ì „ì†¡ ì˜¤ë¥˜ ìƒì„¸:", error);
                
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì¸ì§€ í™•ì¸
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    alert("ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì¸í„°ë„· ì—°ê²° ìƒíƒœë‚˜ ì›¹í›… URLì„ ì ê²€í•´ì£¼ì„¸ìš”.");
                } else if (error.message.includes('CORS')) {
                    alert("CORS ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. n8n ì›¹í›… ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                } else {
                    alert(`ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨: ${error.message}`);
                }
            });
        }

        // í´ë¦­ ì™¸ë¶€ ì˜ì—­ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>